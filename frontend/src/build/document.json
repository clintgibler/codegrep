{"_index":"codesearch","_type":"code","_id":"2e79f3e36463beba5dc52ae6a36356c985b24729","_version":1,"found":true,"_source":{"filename":"src/main/java/in/syam/codesearch/JavaDocument.java","content":"package in.syam.codesearch;\n\nimport in.syam.codesearch.Document;\n\nimport java.io.IOException;\nimport java.nio.file.Path;\n\nimport com.google.common.collect.ImmutableListMultimap;\nimport com.google.common.collect.ImmutableSet;\n\nimport org.antlr.v4.runtime.*;\nimport org.antlr.v4.runtime.tree.*;\nimport grammars.java.*;\n\npublic final class JavaDocument extends Document {\n    private static ImmutableListMultimap<String, Token> extractTokens(JavaLexer lexer) {\n        ImmutableListMultimap.Builder<String, Token> tokens = ImmutableListMultimap.builder();\n        ImmutableSet.Builder<ComparableToken> seen = ImmutableSet.builder();\n\n        Vocabulary v = lexer.getVocabulary();\n        JavaParser parser = new JavaParser(new CommonTokenStream(lexer));\n\n        ParseTreeWalker.DEFAULT.walk(new JavaBaseListener() {\n            @Override\n            public void enterMethodDeclaration(JavaParser.MethodDeclarationContext ctx) {\n                if (ctx.Identifier() != null) {\n                    Token t = ctx.Identifier().getSymbol();\n                    seen.add(new ComparableToken(t));\n                    tokens.put(\"method\", t);\n                }\n            }\n            @Override @Deprecated\n            public void enterAnnotationName(JavaParser.AnnotationNameContext ctx) {\n                if(ctx.qualifiedName() != null) {\n                    System.out.println(\"Annotation: \" + ctx.qualifiedName().getText());\n                }\n\n            }\n        }, parser.compilationUnit());\n\n        \n\n        ImmutableSet<ComparableToken> saw = seen.build();\n        // Extract all other identifiers\n        lexer.reset();\n        for (Token token = lexer.nextToken(); token.getType() != Token.EOF; token = lexer.nextToken()) {\n            String name = v.getSymbolicName(token.getType());\n            if (name != null && name.equals(\"Identifier\")) {\n                if(! saw.contains(new ComparableToken(token))) {\n                    tokens.put(\"identifier\", token);\n                }\n            }\n        }\n        return tokens.build();\n    }\n\n    public JavaDocument(Path path, String repository, String lang) throws IOException {\n        super(path, repository, lang);\n        ANTLRInputStream input = new ANTLRInputStream(super.getContent());\n        JavaLexer lexer = new JavaLexer(input);\n         super.setTokens(extractTokens(lexer));\n   }\n}","repository":"https://github.com/syamp/codesearch.git","language":"java","tokens":[{"text":"extractTokens","line":16,"char":425,"type":"method"},{"text":"enterMethodDeclaration","line":25,"char":860,"type":"method"},{"text":"enterAnnotationName","line":33,"char":1223,"type":"method"},{"text":"in","line":1,"char":8,"type":"identifier"},{"text":"syam","line":1,"char":11,"type":"identifier"},{"text":"codesearch","line":1,"char":16,"type":"identifier"},{"text":"in","line":3,"char":36,"type":"identifier"},{"text":"syam","line":3,"char":39,"type":"identifier"},{"text":"codesearch","line":3,"char":44,"type":"identifier"},{"text":"Document","line":3,"char":55,"type":"identifier"},{"text":"java","line":5,"char":73,"type":"identifier"},{"text":"io","line":5,"char":78,"type":"identifier"},{"text":"IOException","line":5,"char":81,"type":"identifier"},{"text":"java","line":6,"char":101,"type":"identifier"},{"text":"nio","line":6,"char":106,"type":"identifier"},{"text":"file","line":6,"char":110,"type":"identifier"},{"text":"Path","line":6,"char":115,"type":"identifier"},{"text":"com","line":8,"char":129,"type":"identifier"},{"text":"google","line":8,"char":133,"type":"identifier"},{"text":"common","line":8,"char":140,"type":"identifier"},{"text":"collect","line":8,"char":147,"type":"identifier"},{"text":"ImmutableListMultimap","line":8,"char":155,"type":"identifier"},{"text":"com","line":9,"char":185,"type":"identifier"},{"text":"google","line":9,"char":189,"type":"identifier"},{"text":"common","line":9,"char":196,"type":"identifier"},{"text":"collect","line":9,"char":203,"type":"identifier"},{"text":"ImmutableSet","line":9,"char":211,"type":"identifier"},{"text":"org","line":11,"char":233,"type":"identifier"},{"text":"antlr","line":11,"char":237,"type":"identifier"},{"text":"v4","line":11,"char":243,"type":"identifier"},{"text":"runtime","line":11,"char":246,"type":"identifier"},{"text":"org","line":12,"char":264,"type":"identifier"},{"text":"antlr","line":12,"char":268,"type":"identifier"},{"text":"v4","line":12,"char":274,"type":"identifier"},{"text":"runtime","line":12,"char":277,"type":"identifier"},{"text":"tree","line":12,"char":285,"type":"identifier"},{"text":"grammars","line":13,"char":300,"type":"identifier"},{"text":"java","line":13,"char":309,"type":"identifier"},{"text":"JavaDocument","line":15,"char":337,"type":"identifier"},{"text":"Document","line":15,"char":358,"type":"identifier"},{"text":"ImmutableListMultimap","line":16,"char":388,"type":"identifier"},{"text":"String","line":16,"char":410,"type":"identifier"},{"text":"Token","line":16,"char":418,"type":"identifier"},{"text":"JavaLexer","line":16,"char":439,"type":"identifier"},{"text":"lexer","line":16,"char":449,"type":"identifier"},{"text":"ImmutableListMultimap","line":17,"char":466,"type":"identifier"},{"text":"Builder","line":17,"char":488,"type":"identifier"},{"text":"String","line":17,"char":496,"type":"identifier"},{"text":"Token","line":17,"char":504,"type":"identifier"},{"text":"tokens","line":17,"char":511,"type":"identifier"},{"text":"ImmutableListMultimap","line":17,"char":520,"type":"identifier"},{"text":"builder","line":17,"char":542,"type":"identifier"},{"text":"ImmutableSet","line":18,"char":561,"type":"identifier"},{"text":"Builder","line":18,"char":574,"type":"identifier"},{"text":"ComparableToken","line":18,"char":582,"type":"identifier"},{"text":"seen","line":18,"char":599,"type":"identifier"},{"text":"ImmutableSet","line":18,"char":606,"type":"identifier"},{"text":"builder","line":18,"char":619,"type":"identifier"},{"text":"Vocabulary","line":20,"char":639,"type":"identifier"},{"text":"v","line":20,"char":650,"type":"identifier"},{"text":"lexer","line":20,"char":654,"type":"identifier"},{"text":"getVocabulary","line":20,"char":660,"type":"identifier"},{"text":"JavaParser","line":21,"char":685,"type":"identifier"},{"text":"parser","line":21,"char":696,"type":"identifier"},{"text":"JavaParser","line":21,"char":709,"type":"identifier"},{"text":"CommonTokenStream","line":21,"char":724,"type":"identifier"},{"text":"lexer","line":21,"char":742,"type":"identifier"},{"text":"ParseTreeWalker","line":23,"char":760,"type":"identifier"},{"text":"DEFAULT","line":23,"char":776,"type":"identifier"},{"text":"walk","line":23,"char":784,"type":"identifier"},{"text":"JavaBaseListener","line":23,"char":793,"type":"identifier"},{"text":"Override","line":24,"char":827,"type":"identifier"},{"text":"JavaParser","line":25,"char":883,"type":"identifier"},{"text":"MethodDeclarationContext","line":25,"char":894,"type":"identifier"},{"text":"ctx","line":25,"char":919,"type":"identifier"},{"text":"ctx","line":26,"char":946,"type":"identifier"},{"text":"Identifier","line":26,"char":950,"type":"identifier"},{"text":"Token","line":27,"char":994,"type":"identifier"},{"text":"t","line":27,"char":1000,"type":"identifier"},{"text":"ctx","line":27,"char":1004,"type":"identifier"},{"text":"Identifier","line":27,"char":1008,"type":"identifier"},{"text":"getSymbol","line":27,"char":1021,"type":"identifier"},{"text":"seen","line":28,"char":1054,"type":"identifier"},{"text":"add","line":28,"char":1059,"type":"identifier"},{"text":"ComparableToken","line":28,"char":1067,"type":"identifier"},{"text":"t","line":28,"char":1083,"type":"identifier"},{"text":"tokens","line":29,"char":1108,"type":"identifier"},{"text":"put","line":29,"char":1115,"type":"identifier"},{"text":"t","line":29,"char":1129,"type":"identifier"},{"text":"Override","line":32,"char":1178,"type":"identifier"},{"text":"Deprecated","line":32,"char":1188,"type":"identifier"},{"text":"JavaParser","line":33,"char":1243,"type":"identifier"},{"text":"AnnotationNameContext","line":33,"char":1254,"type":"identifier"},{"text":"ctx","line":33,"char":1276,"type":"identifier"},{"text":"ctx","line":34,"char":1302,"type":"identifier"},{"text":"qualifiedName","line":34,"char":1306,"type":"identifier"},{"text":"System","line":35,"char":1353,"type":"identifier"},{"text":"out","line":35,"char":1360,"type":"identifier"},{"text":"println","line":35,"char":1364,"type":"identifier"},{"text":"ctx","line":35,"char":1389,"type":"identifier"},{"text":"qualifiedName","line":35,"char":1393,"type":"identifier"},{"text":"getText","line":35,"char":1409,"type":"identifier"},{"text":"parser","line":39,"char":1465,"type":"identifier"},{"text":"compilationUnit","line":39,"char":1472,"type":"identifier"},{"text":"ImmutableSet","line":43,"char":1511,"type":"identifier"},{"text":"ComparableToken","line":43,"char":1524,"type":"identifier"},{"text":"saw","line":43,"char":1541,"type":"identifier"},{"text":"seen","line":43,"char":1547,"type":"identifier"},{"text":"build","line":43,"char":1552,"type":"identifier"},{"text":"lexer","line":45,"char":1610,"type":"identifier"},{"text":"reset","line":45,"char":1616,"type":"identifier"},{"text":"Token","line":46,"char":1638,"type":"identifier"},{"text":"token","line":46,"char":1644,"type":"identifier"},{"text":"lexer","line":46,"char":1652,"type":"identifier"},{"text":"nextToken","line":46,"char":1658,"type":"identifier"},{"text":"token","line":46,"char":1671,"type":"identifier"},{"text":"getType","line":46,"char":1677,"type":"identifier"},{"text":"Token","line":46,"char":1690,"type":"identifier"},{"text":"EOF","line":46,"char":1696,"type":"identifier"},{"text":"token","line":46,"char":1701,"type":"identifier"},{"text":"lexer","line":46,"char":1709,"type":"identifier"},{"text":"nextToken","line":46,"char":1715,"type":"identifier"},{"text":"String","line":47,"char":1742,"type":"identifier"},{"text":"name","line":47,"char":1749,"type":"identifier"},{"text":"v","line":47,"char":1756,"type":"identifier"},{"text":"getSymbolicName","line":47,"char":1758,"type":"identifier"},{"text":"token","line":47,"char":1774,"type":"identifier"},{"text":"getType","line":47,"char":1780,"type":"identifier"},{"text":"name","line":48,"char":1808,"type":"identifier"},{"text":"name","line":48,"char":1824,"type":"identifier"},{"text":"equals","line":48,"char":1829,"type":"identifier"},{"text":"saw","line":49,"char":1874,"type":"identifier"},{"text":"contains","line":49,"char":1878,"type":"identifier"},{"text":"ComparableToken","line":49,"char":1891,"type":"identifier"},{"text":"token","line":49,"char":1907,"type":"identifier"},{"text":"tokens","line":50,"char":1938,"type":"identifier"},{"text":"put","line":50,"char":1945,"type":"identifier"},{"text":"token","line":50,"char":1963,"type":"identifier"},{"text":"tokens","line":54,"char":2028,"type":"identifier"},{"text":"build","line":54,"char":2035,"type":"identifier"},{"text":"JavaDocument","line":57,"char":2062,"type":"identifier"},{"text":"Path","line":57,"char":2075,"type":"identifier"},{"text":"path","line":57,"char":2080,"type":"identifier"},{"text":"String","line":57,"char":2086,"type":"identifier"},{"text":"repository","line":57,"char":2093,"type":"identifier"},{"text":"String","line":57,"char":2105,"type":"identifier"},{"text":"lang","line":57,"char":2112,"type":"identifier"},{"text":"IOException","line":57,"char":2125,"type":"identifier"},{"text":"path","line":58,"char":2153,"type":"identifier"},{"text":"repository","line":58,"char":2159,"type":"identifier"},{"text":"lang","line":58,"char":2171,"type":"identifier"},{"text":"ANTLRInputStream","line":59,"char":2186,"type":"identifier"},{"text":"input","line":59,"char":2203,"type":"identifier"},{"text":"ANTLRInputStream","line":59,"char":2215,"type":"identifier"},{"text":"getContent","line":59,"char":2238,"type":"identifier"},{"text":"JavaLexer","line":60,"char":2261,"type":"identifier"},{"text":"lexer","line":60,"char":2271,"type":"identifier"},{"text":"JavaLexer","line":60,"char":2283,"type":"identifier"},{"text":"input","line":60,"char":2293,"type":"identifier"},{"text":"setTokens","line":61,"char":2316,"type":"identifier"},{"text":"extractTokens","line":61,"char":2326,"type":"identifier"},{"text":"lexer","line":61,"char":2340,"type":"identifier"}]}}